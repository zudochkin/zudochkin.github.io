---
author: admin
comments: true
date: 2010-03-03 17:20:26+00:00
layout: post
slug: yandex-xml-get-host-position

permalink: /2010/03/yandex-xml-get-host-position

title: Держи позиции сайтов под прицелом (Yandex XML)
wordpress_id: 363
categories:
- jQuery
- php
- программирование
tags:
- seo
- yandex
---

[![](/images/yandex.ru)](/images/yandex.jpg)


Все, кто занимается продвижением или делает это не специально, интересуется позициями своего сайта/сайтов. Хоть и каждый для этого дела использует разные программы/скрипты, я предлагаю же создать что-то под себя почти с нуля. Сегодня мы будем снимать позиции с популярной в России поисковой системы Яндекс. Яндекс разработчикам предлагает очень удобный интерфейс для взаимодействия. Благодаря которому мы с легкостью можем встроить на свой сайт поиск или что-нибудь полезное еще. Но сегодня мы ограничимся лишь снятием для конкретного сайта и ключевого слова позиции.<!-- more --> В начале нам [ зарегистрировать свой IP-адрес](http://xml.yandex.ru/ip.xml), потому как Яндекс накладывает ограничение на количество запросов с одного IP-адреса, но их с лихвой хватит для нескольких сайтов. Нетерпеливым предлагаю сразу [ скачать исходник](/files/yasha.rar) со всеми скриптами и картинкой, отображающейся когда идет запрос, но еще не получен результат. И тут применяется AJAX технология, реализовать которую нам помог так любимый мной jQuery. 




Для начала сам файл, который и будет принимать наши запросы с позицией и сайтом, формировать XML и отправлять Яндексу.




Файл **post.php**


[cc lang="php"]

		
		$query_esc
		$page
		0
		
			
		
	
DOC;

    $context = stream_context_create(array(
        'http' => array(
		'method'=>"POST",
		'header'=>"Content-type: application/xml\r\n" .
			  "Content-length: " . strlen($doc),
		'content'=>$doc
        )
    ));
    $response = file_get_contents('http://xmlsearch.yandex.ru/xmlsearch', true, $context);

    if ( $response ) {
       $xmldoc = new SimpleXMLElement($response);
       $xmlresponce = $xmldoc->response;
        if ($xmlresponce->error) {
            print "Возникла следующая ошибка: " . $xmlresponce->error . "  
\n";
            $exit  = 1;
            $error = true;
            break;
        }
        $pos = 1;
        $nodes = $xmldoc->xpath('/yandexsearch/response/results/grouping/group/doc/url');
        foreach ($nodes as $node) {
            if ( preg_match("/^http:\/\/(www\.)?$host/i", $node) ) {
                $found = $pos + $page * 10;
                $exit = 1;
                break;
            }
            $pos++;
        }
        $page++;
    } else {
        print "внутренняя ошибка сервера\n";
        $exit = 1;
    }
}
if (!$error) {
    // если что-то найдено, то выводим результат 
    if ($found) {
		print $found;
    } elseif ($host) {
        print "

сайт находится далее, чем на ". $pages*10 ." месте в выдаче";
    }
}
?>
[/cc]


В строке указывается количество страниц, которое нужно просмотреть в поисках своего сайта.




И теперь HTML-файл, который обернет нам это большой, но несложный код.


**index.php**
[cc lang="html"]

	
	
		


		  


			
хост

			

			

![](img/ajax.gif)


		  
		  


			
запрос

			

			
запросить

		  
				
	

[/cc]


Вот и все, основную часть кода предоставил Яндекс, я по большей части дописал лишь оболочку и немного модернизировал скрипт запросов. 




Этот скрипт легко можно переделать так, чтобы каждый день он запускался по расписанию и проверял позиции для некоторых ключевых слов для десятка сайтов, сохранял полученную информацию в БД. Насколько мне известно, некоторые SEO-шники получают деньги лишь имея продвигаемый сайт в десятке. Желаю, чтобы позиции ваших сайтов только росли! =)
